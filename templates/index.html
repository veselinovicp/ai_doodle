<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>AI doodle</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

	<link rel="stylesheet" href="{{ url_for('static',filename='normalize.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='skeleton.css') }}">
  <link rel="stylesheet" href="{{ url_for('static',filename='doodle.css') }}">
</head>

<body>


<div class="section">
    <div class="container">
      <h3 class="section-heading">AI style doodle</h3>
      <p class="section-description">Choose image and style and see what AI doodling will make of it.</p>

      <div class="row dr">

        <div class="five columns">
            <img id="image" src="{{ url_for('static',filename='faca.jpg') }}" class="u-max-full-width image"/>
        </div>

          <div class="two columns">
              <h1>+</h1>
          </div>

        <div class="five columns">
            <img id="style" src="{{ url_for('static',filename='van_gough.jpg') }}" class="u-max-full-width image"/>
        </div>

      </div>
      <div class="row">
        <div class="five columns lw">
            <a id="imagebutton" class="button">Choose image</a>
            or
            <a id="randomimage" class="button">Pick random</a>
          
        </div>

        <div class="two columns lw">&nbsp</div>

        <div class="five columns lw">
            <a id="stylebutton" class="button">Choose style</a>
            or
            <a id="randomstyle" class="button">Pick random</a>
        </div>
    </div>

    

    <div class="row dr">
      <div class="twelve columns">
         <img id="result" src="{{ url_for('static',filename='2.png') }}" class="u-max-full-width image"/>
      </div>
    </div>
    <div class="row">
      <a id="stylize" class="button">Stylize!</a>
    </div>


  </div>

  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>

  <script type="text/javascript">
    var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

    $("#randomimage").click(function() {
      $.ajax({
        type: "GET",
        url: $SCRIPT_ROOT + "/randomimage/",
        success: function(response){
          $('#image').attr('src', response);
        }
      });
    });

    $("#randomstyle").click(function() {
      $.ajax({
        type: "GET",
        url: $SCRIPT_ROOT + "/randomstyle/",
        success: function(response){
          $('#style').attr('src', response);
        }
      });
    });

    $("#stylize").click(function(){
      var img = document.getElementById("image");
      var img64 = imageToBase64(img);
      var style = document.getElementById("style");
      var style64 = imageToBase64(style);
      $.ajax({
        type: "POST",
        data: JSON.stringify({'i': img64, 's':style64}),
        url: $SCRIPT_ROOT + "/stylize/",
        success: function(response){
          $('#result').attr('src', response);
        }
      });
    });

    function imageToBase64(img) {
        var canvas, ctx, dataURL, base64;
        canvas = document.createElement("canvas");
        ctx = canvas.getContext("2d");
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        dataURL = canvas.toDataURL("image/png");
        base64 = dataURL.replace(/^data:image\/png;base64,/, "");
        return base64;
    }
 
 </script>

</body>
</html>